const alphabet = {
  "0": [
    "0ï¸âƒ£"
  ],
  "1": [
    "1ï¸âƒ£"
  ],
  "2": [
    "2ï¸âƒ£"
  ],
  "3": [
    "3ï¸âƒ£"
  ],
  "4": [
    "4ï¸âƒ£"
  ],
  "5": [
    "5ï¸âƒ£"
  ],
  "6": [
    "6ï¸âƒ£"
  ],
  "7": [
    "7ï¸âƒ£"
  ],
  "8": [
    "8ï¸âƒ£"
  ],
  "9": [
    "9ï¸âƒ£"
  ],
  "A": [
    "ðŸ…°ï¸",
    "ðŸ‡¦",
    "ðŸ…°",
    "ðŸ™",
    "ðŸ”¼",
    "ðŸ”º",
    "ðŸ…",
    "â’¶",
    "ðŸ„°",
    "â“",
    "Ð°",
    "Ã ",
    "Ã¡",
    "áº¡",
    "Ä…"
  ],
  "B": [
    "ðŸ…±ï¸ï¸",
    "ðŸ‡§",
    "ðŸ…±",
    "ðŸ””",
    "ðŸ”•",
    "ðŸ…‘",
    "â’·",
    "ðŸ„±",
    "â“‘"
  ],
  "C": [
    "Â©ï¸",
    "â˜ªï¸",
    "ðŸ—œï¸",
    "ðŸ‡¨",
    "ðŸ…²",
    "ðŸ…’",
    "â’¸",
    "ðŸ„²",
    "â“’",
    "Ñ",
    "Æˆ",
    "Ä‹"
  ],
  "D": [
    "â†©ï¸",
    "ðŸ‡©",
    "ðŸ…³",
    "ðŸ…“",
    "â’¹",
    "ðŸ„³",
    "â““",
    "Ô",
    "É—"
  ],
  "E": [
    "ðŸ…´",
    "ðŸ“§",
    "ðŸ‡ª",
    "ðŸ…´",
    "ðŸ…”",
    "â’º",
    "ðŸ„´",
    "â“”",
    "Ðµ",
    "áº¹",
    "Ä—",
    "Ä—",
    "Ã©",
    "Ã¨"
  ],
  "F": [
    "ðŸŽ",
    "ðŸ‡«",
    "ðŸ…µ",
    "ðŸ…•",
    "â’»",
    "ðŸ„µ",
    "â“•"
  ],
  "G": [
    "ðŸ…¶",
    "â›½ï¸",
    "ðŸ‡¬",
    "ðŸ…¶",
    "ðŸ…–",
    "â’¼",
    "ðŸ„¶",
    "â“–",
    "Ä¡"
  ],
  "H": [
    "ðŸ©",
    "â™“ï¸",
    "ðŸ‡­",
    "ðŸ…·",
    "ðŸ…—",
    "â’½",
    "ðŸ„·",
    "â“—",
    "Ò»"
  ],
  "I": [
    "ðŸ’ˆ",
    "â„¹ï¸",
    "ðŸ‡®",
    "ðŸ…¸",
    "ðŸ…˜",
    "â’¾",
    "ðŸ„¸",
    "â“˜",
    "Ñ–",
    "Ã­",
    "Ã¬",
    "Ã¯"
  ],
  "J": [
    "â˜”",
    "ðŸŽ·",
    "ðŸ—¾",
    "ðŸ‡¯",
    "ðŸ…¹",
    "ðŸ…™",
    "â’¿",
    "ðŸ„¹",
    "â“™",
    "Ñ˜",
    "Ê"
  ],
  "K": [
    "ðŸ…º",
    "ðŸŽ‹",
    "ðŸ‡°",
    "ðŸ…º",
    "ðŸ…š",
    "â“€",
    "ðŸ„º",
    "â“š",
    "Îº"
  ],
  "L": [
    "ðŸ‘¢",
    "ðŸ•’",
    "ðŸ‡±",
    "ðŸ…»",
    "ðŸ…›",
    "â“",
    "ðŸ„»",
    "â“›",
    "Ó",
    "á¸·"
  ],
  "M": [
    "â“‚ï¸",
    "â™ï¸",
    "â™ï¸",
    "ã€½",
    "ðŸ‡²",
    "ðŸ…¼",
    "ðŸ…œ",
    "â“‚",
    "ðŸ„¼",
    "â“œ"
  ],
  "N": [
    "ðŸ…½",
    "ðŸ“ˆ",
    "ðŸ‡³",
    "ðŸ…½",
    "ðŸ…",
    "â“ƒ",
    "ðŸ„½",
    "â“",
    "Õ¸"
  ],
  "O": [
    "ðŸ…¾ï¸",
    "â­•ï¸",
    "ðŸ’",
    "ðŸ‡´",
    "ðŸ…¾",
    "ðŸ”˜",
    "ðŸ”´",
    "ðŸ”µ",
    "ðŸ…ž",
    "â“„",
    "ðŸ„¾",
    "â“ž",
    "Ð¾",
    "Î¿",
    "Ö…",
    "È¯",
    "á»",
    "á»",
    "Æ¡",
    "Ã¶",
    "Ã³",
    "Ã²"
  ],
  "P": [
    "ðŸ…¿ï¸",
    "ðŸ‡µ",
    "ðŸ…¿",
    "ðŸ…Ÿ",
    "â“…",
    "ðŸ„¿",
    "â“Ÿ",
    "Ñ€"
  ],
  "Q": [
    "ðŸ³",
    "ðŸ­",
    "â™Œ",
    "ðŸ‡¶",
    "â„š",
    "â„º",
    "ðŸ‡¶",
    "ðŸ…€",
    "ðŸ†€",
    "ðŸ… ",
    "â“†",
    "ðŸ…€",
    "â“ ",
    "Õ¦"
  ],
  "R": [
    "â“‡",
    "Â®ï¸",
    "ðŸ‡·",
    "ðŸ…",
    "ðŸ†",
    "ðŸ…¡",
    "â“‡",
    "ðŸ…",
    "â“¡"
  ],
  "S": [
    "ðŸ’°",
    "âš¡ï¸",
    "ðŸ‡¸",
    "ðŸ…‚",
    "ðŸ†‚",
    "ðŸ…¢",
    "â“ˆ",
    "ðŸ…‚",
    "â“¢",
    "Ê‚"
  ],
  "T": [
    "ðŸ‹",
    "âœï¸",
    "ðŸ‡¹",
    "ðŸ…ƒ",
    "ðŸ†ƒ",
    "ðŸ…£",
    "â“‰",
    "ðŸ…ƒ",
    "â“£"
  ],
  "U": [
    "ðŸ‹",
    "â›Ž",
    "ðŸ‡º",
    "ðŸ…„",
    "ðŸ†„",
    "ðŸ…¤",
    "â“Š",
    "ðŸ…„",
    "â“¤",
    "Ï…",
    "Õ½",
    "Ã¼",
    "Ãº",
    "Ã¹"
  ],
  "V": [
    "âœŒï¸ï¸",
    "â™ˆï¸",
    "ðŸ‡»",
    "ðŸ……",
    "ðŸ†…",
    "ðŸ…¥",
    "â“‹",
    "ðŸ……",
    "â“¥",
    "Î½",
    "Ñµ"
  ],
  "W": [
    "ðŸ‘",
    "ã€°ï¸",
    "ðŸ‡¼",
    "ðŸ…†",
    "ðŸ††",
    "ðŸ…¦",
    "â“Œ",
    "ðŸ…†",
    "â“¦"
  ],
  "X": [
    "âŽ",
    "âŒ",
    "âœ–ï¸",
    "ðŸ™…",
    "ðŸ‡½",
    "ðŸ…‡",
    "ðŸ†‡",
    "ðŸ…§",
    "â“",
    "ðŸ…‡",
    "â“§",
    "Ñ…",
    "Ò³"
  ],
  "Y": [
    "ðŸŒ±",
    "ðŸ¸",
    "ðŸ‡¾",
    "ðŸ…ˆ",
    "ðŸ†ˆ",
    "ðŸ…¨",
    "â“Ž",
    "ðŸ…ˆ",
    "â“¨",
    "Ñƒ",
    "Ã½"
  ],
  "Z": [
    "ðŸ’¤",
    "ðŸ‡¿",
    "ðŸ…‰",
    "ðŸ†‰",
    "ðŸ…©",
    "â“",
    "ðŸ…‰",
    "â“©",
    "Ê",
    "Å¼"
  ],
  "!": [
    "â—ï¸",
    "â•"
  ],
  "?": [
    "â“",
    "â”"
  ],
  "#": [
    "#ï¸âƒ£"
  ],
  "*": [
    "*ï¸âƒ£"
  ],
  "+": [
    "âž•"
  ]
};

function pickRandom(array) {
  return array[Math.floor(Math.random() * array.length)];
}

function scramble(word) {
const chars = word.split('');
  const first = chars.shift();
  const last = chars.pop();
  const output = [first];
  while (chars.length > 0) {
    const index = Math.floor(Math.random() * chars.length);
    output.push(chars[index]);
    chars.splice(index, 1);
  }
  output.push(last);
  return output.join('');
}

function obfuscate(input) {
  return input
    .split(' ')
    .map(word => {
      if (word.length > 1) {
        return scramble(word);
      }
      else {
        return word;
      }
    })
    .join(' ')
    .split('')
    .map(char => char.toUpperCase())
    .map(char => alphabet[char] || [char])
    .map(pickRandom)
    .join('');
}

const CONTEXT_MENU_ITEM_ID = 'letter-scrambler';

chrome.runtime.onInstalled.addListener(async () => {
  chrome.contextMenus.create({
    id: CONTEXT_MENU_ITEM_ID,
    title: 'Confute',
    type: 'normal',
    contexts: ['selection'],
  });
});

chrome.contextMenus.onClicked.addListener(async (item, tab) => {
  if (item.menuItemId === CONTEXT_MENU_ITEM_ID && item.selectionText) {
    const oldText = item.selectionText;
    const text = obfuscate(oldText);
    await chrome.tabs.sendMessage(tab.id, { text });
  }
});
